### Patterns 164

#### Context 164

##### Store and retrieve values from a context 164

##### WithCancel

Different ways we can do cancellation, timeout in Go.

```go
package main

import (
    "context"
    "fmt"
    "fime"
)

func main() {
```

Create a context that is cancellable only manually.
The cancel function must be called regardless of the outcome.
`WithCancel` allows us to create a context and provides us a `cancel` function
that can be called in order to report a signal,
a signal without data, that we want to whatever that Goroutine is doing to stop right away.
Again, we are using `Background` as our parents context.

```go
    ctx, cancel := context.WithCancel(context.Background())
```

The cancel function must be called regardless of the outcome.
The Goroutine that creates the context must always call `cancel`.
These are things that have to be cleaned up.
It's the responsibility that the Goroutine creates the context the first time
to make sure to call `cancel` after everything is done.
The use of the `defer` keyword is prefect here for this use case.

```go
    defer cancel()
```

We launch a Goroutine to do some work for us.
It is going to sleep for 50 milliseconds and then call `cancel`.
It is reporting that it wants to signal a `cancel` without data.

```go
    go func() {
```

Simulate work.
If we run the program using 50ms, we expect the work to be complete.
But if it is 150ms, then we move on.

```go
        time.Sleep(50 * time.Millisecond)
```

Report the work is done.

```go
        cancel()
    }()
```

The original Goroutine that creates that channel is in its select case.
It is going to receive after `time.After`.
We are going to wait 100 milliseconds for something to happen.
We are also waiting on `context.Done`.
We are just going to sit here, and if we are told to `Done`,
we know that work up there is complete.

```go
    select {
    case <-time.After(100 * time.Millisecond):
        fmt.Println("moving on")
    case <-ctx.Done():
        fmt.Println("work complete")
    }
}
```

```terminal
work complete
```

##### WithDeadline 168

##### WithTimeout 169

##### Request/Response 171
